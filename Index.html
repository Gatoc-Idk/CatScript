<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CatScript v3.2</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css" />
  <style>
    body { font-family: sans-serif; padding: 1em; background: #fff8f0; }
    #editor { height: 240px; border: 1px solid #ccc; background: #fffefc; }
    canvas { border: 2px solid #333; background: #ffffff; margin-top: 10px; }
    button { margin-top: 10px; margin-right: 10px; padding: 10px 15px; font-size: 14px; cursor: pointer; }
    h1 { color: #3a3a3a; }
    #console { background: #222; color: #0f0; padding: 10px; margin-top: 10px; height: 100px; overflow-y: auto; font-family: monospace; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>üê± CatScript Playground</h1>
  <textarea id="catCode">// Example:
// CleanWhiskers();
// meow color = "hotpink";
// DrawPaw(200, 150, 40, color);</textarea>
  <div id="editor"></div>
  <button onclick="runCatScript()">‚ñ∂Ô∏è Run CatScript</button>
  <button onclick="exportCode()">üíæ Export Code</button>
  <button onclick="importCode()">üìÇ Import Code</button>
  <input type="file" id="fileInput" style="display: none" />
  <canvas id="catCanvas" width="500" height="350"></canvas>
  <div id="console"></div>

  <!-- CodeMirror -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/javascript/javascript.min.js"></script>

  <script>
    const canvas = document.getElementById('catCanvas');
    const ctx = canvas.getContext('2d');
    const consoleEl = document.getElementById('console');
    const fileInput = document.getElementById('fileInput');
    const textarea = document.getElementById('catCode');

    const editor = CodeMirror.fromTextArea(textarea, {
      mode: 'javascript',
      theme: 'default',
      lineNumbers: true
    });

    function logToConsole(message) {
      consoleEl.textContent += message + "\n";
      consoleEl.scrollTop = consoleEl.scrollHeight;
    }

    function CleanWhiskers() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function DrawPaw(x, y, size, color) {
      ctx.beginPath();
      ctx.arc(x, y, size, 0, Math.PI * 2);
      ctx.fillStyle = color;
      ctx.fill();
    }

    // 50+ CatScript commands mapped to JS
    const catWords = {
      "meow": "let", "purr": "logToConsole", "scratch": "function",
      "DrawPaw": "DrawPaw", "CleanWhiskers": "CleanWhiskers",
      "SetFurColor": "ctx.fillStyle", "SetWhiskerColor": "ctx.strokeStyle",
      "BeginPathPaw": "ctx.beginPath", "ClosePathPaw": "ctx.closePath",
      "DrawCircleOfPaws": "ctx.arc", "DrawWhiskerBox": "ctx.strokeRect",
      "FillFurRect": "ctx.fillRect", "FillFurText": "ctx.fillText",
      "SetPawFont": "ctx.font", "SetPawAlign": "ctx.textAlign",
      "SavePurrState": "ctx.save", "RestorePurrState": "ctx.restore",
      "TranslateTail": "ctx.translate", "RotateTail": "ctx.rotate",
      "ScaleFur": "ctx.scale", "SetClawCap": "ctx.lineCap",
      "SetTailJoin": "ctx.lineJoin", "SetFurShadow": "ctx.shadowColor",
      "SetPawBlur": "ctx.shadowBlur", "SetShadowTailOffsetX": "ctx.shadowOffsetX",
      "SetShadowTailOffsetY": "ctx.shadowOffsetY", "SetWhiskerWidth": "ctx.lineWidth",
      "SetBlendPurr": "ctx.globalCompositeOperation", "DrawNapZone": "ctx.fillRect",
      "DrawYarn": "ctx.strokeRect", "DrawFish": "ctx.arc", "DrawMewStar": "ctx.arc",
      "AlertCat": "alert", "CatPrompt": "prompt", "CatConfirm": "confirm",
      "MoveToPaw": "ctx.moveTo", "LineToClaw": "ctx.lineTo",
      "FillPawPrint": "ctx.fill", "StrokeTailEdge": "ctx.stroke",
      "DrawTailTip": "ctx.beginPath", "FlipPaw": "ctx.scale",
      "SetCursorFur": "document.body.style.cursor", "DrawBell": "ctx.arc",
      "DrawCatEye": "ctx.arc", "DrawSnout": "ctx.arc", "DrawMuzzle": "ctx.arc",
      "DrawKitten": "ctx.fillRect", "DrawSleepingPose": "ctx.fillRect",
      "DrawRunningPose": "ctx.fillRect", "DrawSittingPose": "ctx.fillRect",
      "DrawCatShadow": "ctx.shadowColor", "SetGlowPurr": "ctx.shadowColor",
      "DrawToyMouse": "ctx.strokeRect", "DrawCatnip": "ctx.fillRect",
      "DrawPillow": "ctx.fillRect", "DrawMilkDish": "ctx.arc",
      "DrawSleepingBubble": "ctx.arc", "DrawEars": "ctx.moveTo",
      "DrawClawMark": "ctx.lineTo", "WhiskerSpin": "ctx.rotate",
      "SetTailColor": "ctx.strokeStyle"
    };

    function translateCatScript(code) {
      for (let [catWord, jsWord] of Object.entries(catWords)) {
        const regex = new RegExp("\\b" + catWord + "\\b", "g");
        code = code.replace(regex, jsWord);
      }
      return code;
    }

    function runCatScript() {
      CleanWhiskers();
      consoleEl.textContent = '';
      const code = editor.getValue();
      const translated = translateCatScript(code);
      try {
        new Function(translated)();
      } catch (err) {
        logToConsole("CatScript Error: " + err.message);
      }
    }

    function exportCode() {
      const blob = new Blob([editor.getValue()], { type: 'text/plain' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'catscript.txt';
      a.click();
    }

    function importCode() {
      fileInput.click();
    }

    fileInput.addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        editor.setValue(reader.result);
      };
      reader.readAsText(file);
    });
  </script>
</body>
</html>
